<!DOCTYPE html>

<html>
<head>
  <title>backbone-faux-server.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>backbone-faux-server.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <pre><code>Backbone Faux Server v0<span class="hljs-number">.10</span><span class="hljs-number">.5</span>

https:<span class="hljs-comment">//github.com/biril/backbone-faux-server</span>
Licensed and freely distributed under the MIT License
Copyright (c) <span class="hljs-number">2012</span>-<span class="hljs-number">2014</span> Alex Lambiris
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/*global exports, define, global, require, _, Backbone */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="detect-env-export-module">Detect env &amp; export module</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(root, createModule)</span> </span>{
<span class="hljs-pi">    "use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Detect current environment. Faux-server will be exposed as module / global accordingly:</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>A global <code>exports</code> object signifies CommonJS-like enviroment that supports <code>module.exports</code>,
 e.g. Node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports === <span class="hljs-string">"object"</span>) {
        <span class="hljs-keyword">return</span> createModule(exports, <span class="hljs-built_in">require</span>(<span class="hljs-string">"underscore"</span>), <span class="hljs-built_in">require</span>(<span class="hljs-string">"backbone"</span>));
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>A global <code>define</code> method with an <code>amd</code> property signifies the presence of an AMD loader
 (require.js, curl.js)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">"function"</span> &amp;&amp; define.amd) {
        <span class="hljs-keyword">return</span> define([<span class="hljs-string">"underscore"</span>, <span class="hljs-string">"backbone"</span>, <span class="hljs-string">"exports"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(_, Backbone, exports)</span> </span>{
            <span class="hljs-keyword">return</span> createModule(exports, _, Backbone);
        });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Otherwise we assume running in a browser:</p>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Save a reference to previous value of <code>fauxServer</code> before (potentially) overwriting it - so
 that it can be restored on <code>noConflict</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> previousFauxServer = root.fauxServer;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>    createModule(root.fauxServer = {}, _, Backbone);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>The <code>noConflict</code> method sets the <code>fauxServer</code> <em>global</em> to to its previous value (<em>once</em>),
 returning a reference to <code>fauxServer</code> (<em>always</em>)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    root.fauxServer.noConflict = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> fauxServer = root.fauxServer;
        root.fauxServer = previousFauxServer;
        <span class="hljs-keyword">return</span> (fauxServer.noConflict = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> fauxServer; }).call();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="create-module">Create module</h2>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
}(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fauxServer, _, Backbone)</span> </span>{
<span class="hljs-pi">    "use strict"</span>;

    <span class="hljs-keyword">var</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>A no-op method to reuse</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        noOp = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{},</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Clone an array skipping all tail-elements which are undefined. <code>Array.length</code> can’t be
 trusted for arrays containing tail-element(s) explicitly set to <code>undefined</code> as it’s
 always set to the index of the last element plus one - and a tail element explicitly
 set to undefined will in fact count as the ‘last element’. Problematic when counting
 function arguments in order to sanitize, provide defaults, etc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        skipUndefinedTail = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(array)</span> </span>{
            <span class="hljs-keyword">var</span> a = [], i = array.length - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">for</span> (; i &gt;= <span class="hljs-number">0</span>; i--) { <span class="hljs-keyword">if</span> (!_.isUndefined(array[i])) { a[i] = array[i]; } }
            <span class="hljs-keyword">return</span> a;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Convert a urlExp string - a string containing parameter parts (‘:param’), splat parts
 (‘*splat’) and parentheses into a regular expression</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        makeRegExp = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>To escape special chars before converting to reg-exp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                e = <span class="hljs-regexp">/[\-{}\[\]+?.,\\\^$|#\s]/g</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Optional part</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                o = <span class="hljs-regexp">/\((.*?)\)/g</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Named param (+ extra capturing parens for opt-part detection)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                p = <span class="hljs-regexp">/(\(\?)?:[A-Za-z_](?:\w)+/g</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Splat param</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                s = <span class="hljs-regexp">/\*\w+/g</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Don’t confuse (regex-equivalent-subsituted) optional parts with named params</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                getReplacementForP = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(match, isOptPart)</span> </span>{
                    <span class="hljs-keyword">return</span> isOptPart ? match : <span class="hljs-string">"([^\/]+)"</span>;
                };

            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(exp)</span> </span>{
                exp = exp.replace(e, <span class="hljs-string">"\\$&amp;"</span>)
                         .replace(o, <span class="hljs-string">"(?:$1)?"</span>)
                         .replace(p, getReplacementForP)
                         .replace(s, <span class="hljs-string">"(.*?)"</span>);

                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"^"</span> + exp + <span class="hljs-string">"$"</span>);
            };
        }()),</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Save a reference to the native sync method. Will be invoked when no route is matched
 during sync (and there’s no default-route) or faux-server is disabled altogether</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        nativeSync = Backbone.sync,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Indicates whether faux-server is currently enabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        isEnabled = <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>The default-route - a route that contains the default handler if one is defined. The
 default handler is invoked when no matching route is found for some model-URL /
 sync-method pair and may be set by means of <code>setDefaultHandler</code>. A <code>null</code> value
 signifies the absence of a default handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        defaultRoute = <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Server’s emulated latency</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        latency = <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Mapping of CRUD (+ patch) to HTTP verbs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        crudToHttp = {
            <span class="hljs-string">"create"</span>: <span class="hljs-string">"POST"</span>,
            <span class="hljs-string">"read"</span>: <span class="hljs-string">"GET"</span>,
            <span class="hljs-string">"update"</span>: <span class="hljs-string">"PUT"</span>,
            <span class="hljs-string">"delete"</span>: <span class="hljs-string">"DELETE"</span>,
            <span class="hljs-string">"patch"</span>: <span class="hljs-string">"PATCH"</span>
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Collection of all defined routes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        routes = [],</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Get a route matching the given &lt;<code>url</code>, <code>httpMethod</code>&gt; pair. Routes that exactly match the
 HTTP-method take precedence over match-all-methods routes (those with <code>httpMethod</code> set
 to ‘*’). Matching routes that were defined later take precedence over those that were
 defined earlier. A returned matching route will contain the additional <code>handlerParams</code>
 property: an array containing params that are to be passed to the handler as captured
 when the given URL was matched. Will return <code>null</code> if no route found. Note that
 the acquired route is a copy - it cannot be modified to affect faux-server’s behaviour</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getMatchingRoute = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(url, httpMethod)</span> </span>{
            <span class="hljs-keyword">var</span> i, r, weakMatch;
            <span class="hljs-keyword">for</span> (i = routes.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; --i) { <span class="hljs-comment">// Iterating from latest to earliest</span>
                r = routes[i];
                <span class="hljs-keyword">if</span> (r.urlExp.test(url)) {
                    <span class="hljs-keyword">if</span> (r.httpMethod === httpMethod) { <span class="hljs-comment">// Found a match ..</span>
                        r = _.clone(r);
                        r.handlerParams = r.urlExp.exec(url).slice(<span class="hljs-number">1</span>);
                        <span class="hljs-keyword">return</span> r; <span class="hljs-comment">// .. so return it. We're done</span>
                    }
                    <span class="hljs-keyword">if</span> (r.httpMethod === <span class="hljs-string">"*"</span>) { weakMatch = r; } <span class="hljs-comment">// Found a weak match</span>
                }
            }
            <span class="hljs-keyword">if</span> (weakMatch) { <span class="hljs-comment">// Found a weak match. That's good too ..</span>
                r = _.clone(weakMatch);
                r.handlerParams = r.urlExp.exec(url).slice(<span class="hljs-number">1</span>);
                <span class="hljs-keyword">return</span> r; <span class="hljs-comment">// .. so return it. We're done</span>
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Create route for given <code>name</code>, <code>urlExp</code>, <code>httpMethod</code> and <code>handler</code>. Will set missing
 arguments to defaults and sanitize values where appropriate - note that the only
 mandatory argument is <code>urlExp</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        createRoute = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, urlExp, httpMethod, handler)</span> </span>{
            <span class="hljs-keyword">var</span> args = skipUndefinedTail(_.toArray(<span class="hljs-built_in">arguments</span>));

            <span class="hljs-keyword">switch</span> (args.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Missing <code>name</code>, <code>handler</code> or <code>httpMethod</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Missing <code>name</code> or <code>httpMethod</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (_.isFunction(args[<span class="hljs-number">2</span>])) {
                    handler = args[<span class="hljs-number">2</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Missing <code>name</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (args[<span class="hljs-number">1</span>] === <span class="hljs-string">"*"</span> || _.contains(crudToHttp, args[<span class="hljs-number">1</span>])) {
                        urlExp = args[<span class="hljs-number">0</span>];
                        httpMethod = args[<span class="hljs-number">1</span>];
                        name = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Missing <code>httpMethod</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    } <span class="hljs-keyword">else</span> {
                        httpMethod = <span class="hljs-string">"*"</span>;
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Missing <code>handler</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                } <span class="hljs-keyword">else</span> {
                    handler = noOp;
                }
                <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Missing <code>name</code> &amp; <code>httpMethod</code>, <code>httpMethod</code> &amp; <code>handler</code> or <code>name</code> &amp; <code>handler</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Missing <code>name</code> &amp; <code>httpMethod</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (_.isFunction(args[<span class="hljs-number">1</span>])) {
                    urlExp = args[<span class="hljs-number">0</span>];
                    handler = args[<span class="hljs-number">1</span>];
                    httpMethod = <span class="hljs-string">"*"</span>;
                    name = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Missing <code>name</code> &amp; <code>handler</code> or <code>httpMethod</code> &amp; <code>handler</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                } <span class="hljs-keyword">else</span> {
                    handler = noOp;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Missing <code>name</code> &amp; <code>handler</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (args[<span class="hljs-number">1</span>] === <span class="hljs-string">"*"</span> || _.contains(crudToHttp, args[<span class="hljs-number">1</span>])) {
                        urlExp = args[<span class="hljs-number">0</span>];
                        httpMethod = args[<span class="hljs-number">1</span>];
                        name = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Missing <code>httpMethod</code> &amp; <code>handler</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    } <span class="hljs-keyword">else</span> {
                        httpMethod = <span class="hljs-string">"*"</span>;
                    }
                }
                <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Missing <code>name</code> &amp; <code>httpMethod</code> &amp; <code>handler</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                urlExp = args[<span class="hljs-number">0</span>];
                httpMethod = <span class="hljs-string">"*"</span>;
                handler = noOp;
                name = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"addRoute: Missing mandatory 'urlExp' argument"</span>);
            }

            httpMethod = httpMethod.toUpperCase();
            urlExp = _.isRegExp(urlExp) ? urlExp : makeRegExp(urlExp);

            <span class="hljs-keyword">return</span> {
                name: name || _.uniqueId(httpMethod + <span class="hljs-string">"_"</span> + urlExp + <span class="hljs-string">"_"</span>),
                urlExp: urlExp,
                httpMethod: httpMethod,
                handler: handler
            };
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Get the data that should be sent to the server during a sync. This depends on
 the sync-method being used and any options that may have been given</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getRequestData = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(httpMethod, model, options)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>A <code>data</code> property whithin options overrides any Model data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (options.data) { <span class="hljs-keyword">return</span> options.data; }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>In the specific case of PATCH, a hash of ‘changed attributes’ is expected within
 options. If no such thing is present then the complete Model representation will
 be used instead</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (httpMethod === <span class="hljs-string">"PATCH"</span>) { <span class="hljs-keyword">return</span> options.attrs || model.toJSON(); }</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Send the complete Model representation when POSTing or PUTing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (httpMethod === <span class="hljs-string">"POST"</span> || httpMethod === <span class="hljs-string">"PUT"</span>) { <span class="hljs-keyword">return</span> model.toJSON(); }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Invoked <em>per sync</em> (with the relevant options / context) to create a new transport -
 a deferred-like object implementing a <code>promise</code> / <code>resolve</code> / <code>reject</code> interface. A
 successfull sync will invoke <code>transport.resolve</code> while a failed one will invoke
 <code>transport.reject</code>. The sync method will always return <code>transport.promise()</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        createTransport = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(syncOptions <span class="hljs-comment">/*, syncContext */</span>)</span> </span>{
            <span class="hljs-keyword">var</span> success = syncOptions.success || noOp,
                error = syncOptions.error || noOp;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>If an underlying ajax lib is defined for Backbone (<code>Backbone.$</code>) and it features a
 <code>Deferred</code> method (which is precisely the case when <code>Backbone.$</code> = <code>jQuery</code>) then
 attempt to create a ‘deferred transport’ which will invoke the <code>success</code> / <code>error</code>
 callbacks when its promise is fulfilled / rejected. Note that sync will return the
 transport’s promise <em>not</em> the transport itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (Backbone.$ &amp;&amp; _.isFunction(Backbone.$.Deferred)) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">var</span> deferred = Backbone.$.Deferred();
                    deferred.then(success, error);
                    <span class="hljs-keyword">return</span> deferred;
                } <span class="hljs-keyword">catch</span> (e) {}
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Otherwise create a poor-man’s deferred - an object that implements a dumb
 <code>promise</code> / <code>resolve</code> / <code>reject</code> interface without actual promise semantics:
 <code>resolve</code> and <code>reject</code> just delegate to <code>success</code> and <code>error</code> callbacks while
 <code>promise</code> returns an <code>undefined</code>. This is a good enough transport</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> {
                promise: noOp,
                resolve: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> </span>{ success(value); },
                reject: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(reason)</span> </span>{ error(reason); }
            };
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h3 id="the-sync-method">The Sync method</h3>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Replace Backbone’s native sync with faux-server sync:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Backbone.sync = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(crudMethod, model, options)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>If faux-server is disabled, fall back to original sync</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!isEnabled) { <span class="hljs-keyword">return</span> nativeSync.call(model, crudMethod, model, options); }

        _.defaults(options || (options = {}), {
            emulateHTTP: Backbone.emulateHTTP,
            emulateJSON: Backbone.emulateJSON
        });

        <span class="hljs-keyword">var</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Sync context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            ctx = {
                data: <span class="hljs-literal">null</span>,
                url: <span class="hljs-literal">null</span>,
                httpMethod: crudToHttp[crudMethod],
                route: <span class="hljs-literal">null</span>
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>An exec-method to actually run the appropriate handler. Defined below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            execHandler = <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>We’ll be creating a transport for this sync..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            transport = <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>..and returning the transport’s promise</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            transportPromise = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>When emulating HTTP, ‘create’, ‘update’, ‘delete’ and ‘patch’ are all mapped to POST.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (options.emulateHTTP &amp;&amp; ctx.httpMethod !== <span class="hljs-string">"GET"</span>) {
            ctx.httpMethodOverride = ctx.httpMethod;
            ctx.httpMethod = <span class="hljs-string">"POST"</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Ensure that we have a URL (A <code>url</code> property whithin options overrides Model /
 Collection URL)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>(!(ctx.url = options.url || _.result(model, <span class="hljs-string">"url"</span>))) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"sync: Undefined 'url' property or function of Model / Collection"</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Find route for given URL or fall back to native sync if none found</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!(ctx.route = getMatchingRoute(ctx.url, ctx.httpMethod) || defaultRoute)) {
            <span class="hljs-keyword">return</span> nativeSync.call(model, crudMethod, model, options);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Ensure that we have the appropriate request data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        ctx.data = getRequestData(ctx.httpMethod, model, options);</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Create a transport for this sync</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        transport = createTransport(options, ctx);</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>An exec-method to actually run the handler and subsequently invoke success / error
 callbacks. (The relevant ‘success’ or ‘error’ event will be triggered by backbone)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        execHandler = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> result = ctx.route.handler.apply(<span class="hljs-literal">null</span>, [ctx].concat(ctx.route.handlerParams));
            transport[_.isString(result) ? <span class="hljs-string">"reject"</span> : <span class="hljs-string">"resolve"</span>](result);
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>The transport’s promise to return. Assuming the default transport-factory implementation
 this may be an actual promise or just undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        transportPromise = transport.promise();

        model.trigger(<span class="hljs-string">"request"</span>, model, transportPromise, options);</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Call exec-method asynchronously, taking into account any given latency</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _.delay(execHandler, _.isFunction(latency) ? latency(ctx) : latency);

        <span class="hljs-keyword">return</span> transportPromise;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <h3 id="the-fauxserver-api">The fauxServer API</h3>

            </div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Extend <code>fauxServer</code> with the fauxServer API methods:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.extend(fauxServer, {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <h4 id="addroute-name-urlexp-httpmethod-handler-">addRoute([name, ]urlExp[, httpMethod][, handler])</h4>
<p>Add a route to the faux-server - a mapping from a Model(or Collection)-URL &amp; sync-method
 (an HTTP verb (POST, GET, PUT, PATCH or DELETE)) to some specific handler (callback):
 <code>&lt;model-URL, sync-method&gt; -&gt; handler</code>. Whenever a Model is created, read, updated or
 deleted, its URL and the the sync method being used will be tested against defined
 routes in order to find a handler for creating, reading, updating or deleting this
 Model. The same applies to reading Collections. When a match for the <model-URL,
 sync-method> pair is <em>not</em> found among defined routes, the native sync will be invoked
 (this behaviour may be overriden - see <code>setDefaultHandler</code>). Later routes take
 precedence over earlier routes so in configurations where multiple routes match,
 the one most recently defined will be used.</p>
<p> The route <code>name</code> is optional and a named route may be queried and / or removed by its
  name. Additionally, a named route will replace an earlier defined route of same name.</p>
<p> The route <code>urlExp</code> is an expression against which, Model(or Collection)-URLs will be
  matched. This is syntactically and functionally analogous to Backbone routes,
  featuring parameter parts (‘:param’), splat parts (‘*splat’) and parentheses. The
  values captured by params and splats will be passed as parameters to the given handler
  method. Regular expressions may also be used, in which case all values captured by
  reg-exp capturing groups will be passed as parameters to the given handler method.
  Note that <code>:param</code>s are required to begin with a letter or underscore - those that
  don’t are treated as a fixed part of the URL.</p>
<p> The route’s <code>httpMethod</code> is an HTTP verb (POST, GET, PUT, PATCH or DELETE), that should
  trigger the route’s handler. Both the URL-expression and the method should match for
  the handler to be invoked. httpMethod may also be set to ‘*’ (or omitted) to create a
  match-all-methods handler: One that will be invoked whenever urlExp matches the
  model’s (or collection’s) URL <em>regardless</em> of method. In the scope of a
  match-all-methods handler, the HTTP method currently being handled may be acquired by
  querying the context parameter for <code>context.httpMethod</code>. Note that when
  <code>Backbone.emulateHTTP</code> is set to true or <code>emulateHTTP</code> is passed as an inline option
  during sync, ‘create’, ‘update’, ‘delete’ and ‘patch’ will all be mapped to POST. In
  this case <code>context.httpMethod</code> will be set to POST and the true HTTP method may be
  acquired by querying <code>context.httpMethodOverride</code>.</p>
<p> The route <code>handler</code>‘s signature should be
  <code>function (context, [param1, [param2, ...]])</code>
  where <code>context</code> contains properties <code>data</code>, <code>httpMethod</code>, <code>httpMethodOverride</code>,
  <code>route</code> and <code>param1</code>, <code>param2</code>, … are parameters derived by matching the <code>urlExp</code> to
  the Model (or Collection) URL. Specifically, about <code>context</code> properties:</p>
<ul>
<li><code>context.data</code>: Attributes of the Model (or Collection) being processed. Valid
 only on ‘create’ (POST), ‘update’ (PUT) or ‘patch’ (PATCH). In the specific case of
 PATCH, context.data may only contain a <em>subset</em> of Model’s attributes.</li>
<li><code>context.httpMethod</code>: The HTTP Method (POST, GET, PUT, PATCH, DELETE) that
 is currently being handled.</li>
<li><code>context.url</code>: The URL that is currently being handled.</li>
<li><code>context.httpMethodOverride</code>: The true HTTP Method (POST, GET, PUT, PATCH, DELETE)
 that is currently being handled when Backbone.emulateHTTP is set to true.
 The equivalent of Backbone’s X-HTTP-Method-Override header.</li>
<li><p><code>context.route</code>: The route that is currently being handled.</p>
<p>On success, the handler should return created Model attributes after handling a POST or
updated Model attributes after handling a PUT or PATCH. Return Model attributes after
handling a GET or an array of Model attributes after handling a GET that refers to a
collection. Note that only attributes that have been changed on the server (and should
be updated on the client) need to be included. Return nothing after handling a DELETE.
On failure, the handler should return s string (presumably a custom error message, an
HTTP status code that indicates failure, etc).</p>
</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        addRoute: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/* name, urlExp, httpMethod, handler */</span>)</span> </span>{
            <span class="hljs-keyword">var</span> route, routeIndex;</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Create the route, defaulting and sanitizing where appropriate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            route = createRoute.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>If a route of given name is already present then overwrite it with this one.
 Otherwise just append the new route</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            _.any(routes, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(r, i)</span> </span>{
                <span class="hljs-keyword">if</span> (r.name === route.name) {
                    routeIndex = i;
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }) || (routeIndex = routes.length);
            routes[routeIndex] = route;

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <h4 id="addroutes-routes-">addRoutes(routes)</h4>
<p>Add multiple routes to faux-server. Given <code>routes</code> should be a hash or array: In the
 case of a hash, keys should be route names and each route (nested hash) need only
 contain <code>urlExp</code>, <code>httpMethod</code> and <code>handler</code>. Also see <code>addRoute</code>. Returns the
 faux-server</p>

            </div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        addRoutes: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(routes)</span> </span>{
            <span class="hljs-keyword">var</span> isArray = _.isArray(routes);
            _.each(routes, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(r, rName)</span> </span>{
                <span class="hljs-keyword">this</span>.addRoute(isArray ? r.name : rName, r.urlExp, r.httpMethod, r.handler);
            }, <span class="hljs-keyword">this</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <h4 id="removeroute-routename-">removeRoute(routeName)</h4>
<p>Remove route of given <code>routeName</code>. Returns the faux-server</p>

            </div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        removeRoute: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(routeName)</span> </span>{
            routes = _.reject(routes, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(r)</span> </span>{ <span class="hljs-keyword">return</span> r.name === routeName; });
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <h4 id="removeroutes-">removeRoutes()</h4>
<p>Remove all previously defined routes. Returns the faux-server</p>

            </div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        removeRoutes: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            routes = [];
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <h4 id="getroute-routename-">getRoute(routeName)</h4>
<p>Get route of given <code>routeName</code> or <code>null</code> if no such route exists. Note that the
 acquired route is a copy - it cannot be modified to affect faux-server’s behaviour</p>

            </div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        getRoute: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(routeName)</span> </span>{
            <span class="hljs-keyword">var</span> route = _.find(routes, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(r)</span> </span>{ <span class="hljs-keyword">return</span> r.name === routeName; });
            <span class="hljs-keyword">return</span> route ? _.clone(route) : <span class="hljs-literal">null</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <h4 id="getrouteat-index-">getRouteAt(index)</h4>
<p>Get route at given <code>index</code> or <code>null</code> if no such route exists. Note that the
 acquired route is a copy - it cannot be modified to affect faux-server’s behaviour</p>

            </div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        getRouteAt: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> </span>{
            <span class="hljs-keyword">return</span> routes[index] ? _.clone(routes[index]) : <span class="hljs-literal">null</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <h4 id="getmatchingroute-url-httpmethod-">getMatchingRoute(url, httpMethod)</h4>
<p>Get route matching the given &lt;<code>url</code>, <code>httpMethod</code>&gt; pair or <code>null</code> if no such route
 exists. Note that the acquired route is a copy - it cannot be modified to affect
 faux-server’s behaviour. See earlier definition of <code>getMatchingRoute</code> for details</p>

            </div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        getMatchingRoute: getMatchingRoute,</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <h4 id="setdefaulthandler-handler-">setDefaultHandler([handler])</h4>
<p>Set the given <code>handler</code> as the one to be invoked when no route is matched to the current
 <model-URL, sync-method> pair. This will override the default behaviour of invoking the
 native sync. Omit the parameter to reset to the default behaviour. See <code>addRoute</code> for
 handler’s signature and semantics. Note that a default-handler isn’t part of a route,
 so the <code>context.route</code> parameter will not be valid. Returns the faux-server</p>

            </div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        setDefaultHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(handler)</span> </span>{
            defaultRoute = !handler ? <span class="hljs-literal">null</span> : {
                name: <span class="hljs-string">""</span>,
                urlExp: <span class="hljs-string">""</span>,
                handler: handler,
                handlerParams: []
            };
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <h4 id="setlatency-min-max-">setLatency(min[, max])</h4>
<p>Set server’s emulated latency to <code>min</code> ms or a random latency withing [<code>min</code>, <code>max</code>] ms
 when the optional <code>max</code> parameter is given. Omitting both parameters will set latency
 to 0. In place of a fixed minimum, a function may also be given that returns a latency.
 The function will be invoked per handled route, with the same parameters as those
 passed to the relevant route handler (<code>context</code>, etc). Returns the faux-server</p>

            </div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        setLatency: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(min, max)</span> </span>{
            latency = !max ? (min || <span class="hljs-number">0</span>) : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> min + <span class="hljs-built_in">Math</span>.random() * (max - min); };
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <h4 id="settransportfactory-factory-">setTransportFactory(factory)</h4>
<p>Set the server’s transport factory - a factory function with signature
 <code>function (syncOptions, syncContext)</code>
 invoked  <em>per sync</em> (with the relevant options / context) to create a new transport - a
 deferred-like object implementing a <code>promise</code> / <code>resolve</code> / <code>reject</code> interface. A
 successfull sync will invoke <code>transport.resolve</code> while a failed one will invoke
 <code>transport.reject</code> The sync method will always return <code>transport.promise()</code>. Returns
 the faux-server</p>

            </div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        setTransportFactory: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(factory)</span> </span>{
            createTransport = factory;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <h4 id="enable-shouldenable-">enable(shouldEnable)</h4>
<p>Enable / disable the faux-server. When disabled, sync will be delegated to the native
 backbone <code>sync</code>. Handy for easily toggling between mock / real server. Set
 <code>shouldEnable</code> to <code>true</code> or omit altogether to enable, set to <code>false</code> to disable.
 Returns the faux-server</p>

            </div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        enable: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(shouldEnable)</span> </span>{
            isEnabled = _.isUndefined(shouldEnable) || shouldEnable;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <h4 id="getversion-">getVersion()</h4>
<p>Get faux-server version</p>

            </div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        getVersion: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"0.10.5"</span>; <span class="hljs-comment">// Keep in sync with package.json</span>
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <h4 id="get-post-put-patch-del-name-urlexp-handler-">get/post/put/patch/del([name, ]urlExp[, handler])</h4>
<p>Add a route to the faux-server, for HTTP GET / POST / PUT / PATCH / DEL</p>

            </div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Attach <code>&lt;httpMethod&gt;(name, urlExp, handler)</code> shortcut-methods which delegate to <code>addRoute</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(_.values(crudToHttp), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(httpMethod)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>All shortcut-methods are named after the relevant HTTP verb except for ‘delete’ which is
 abbreviated to ‘del’ to avoid reserved-word trouble</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> method = httpMethod === <span class="hljs-string">"DELETE"</span> ? <span class="hljs-string">"del"</span> : httpMethod.toLowerCase();

        fauxServer[method] = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> args = skipUndefinedTail(_.toArray(<span class="hljs-built_in">arguments</span>));
            <span class="hljs-keyword">if</span> (!args.length) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(method + <span class="hljs-string">": Missing mandatory 'urlExp' argument"</span>); }</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>The <code>httpMethod</code> must be inserted into the args, either at tail-position if
 <code>handler</code> is missing or just before it (after <code>urlExp</code>) if it’s present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!_.isFunction(args[args.length - <span class="hljs-number">1</span>])) { args.push(httpMethod); }
            <span class="hljs-keyword">else</span> { args.splice(args.length - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, httpMethod); }</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Delegate to <code>addRoute</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> fauxServer.addRoute.apply(<span class="hljs-keyword">this</span>, args);
        };
    });

    <span class="hljs-keyword">return</span> fauxServer;
}));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
